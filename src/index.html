<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>MySQL Document Store and Node.JS</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/white.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<link rel="stylesheet" href="css/reveal-orcl-override.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section data-background="images/mysql_bg.jpg" class="mysql-full">MySQL Document Store</section>
				<section>
					<!-- ~5 minutes -->
					<p>Welcome, who are we?</p>
					<table><!-- Yay I'm still a table fan, yes, I'm stuck in HTML 3 :-D -->
						<!-- Sackoveflow uses typical CSS stuff: https://stackoverflow.com/questions/30861845/how-to-use-two-column-layout-with-reveal-js -->
						<tr>
							<td><!-- img src="" --> Johannes Schlüter</td>
							<td><!-- img src="" --> Rui Quelhas</td>
						</tr>
					</table>
					<aside class="notes">
						Also point to MySQLers in audience!
						<ul>
							<li>Geir? - Server lead</li>
							<li>Jan? - DocStore Architect, Server Plugin lead</li>
							<li>LeFred? - Community, InnoDB Cluster expert</li>
							<li>Others!</li>
						</ul>
						All questions could be answered ;-)
					</aside>
				</section>
				<section>
					<!-- Johannes: -->
					<!-- ~10 minutes -->
					<section>Introduction to MySQL Document Store</section>
					<section>Problem statement .... bla bla</section>
					<section>Introduced with 5.7.?, new protocol, common set of APIs</section>
					<section>MySQL Shell</section>
					<section>Support for C++, Java, .Net (C# etc.), Python, PHP</section>
				</section>
				<section>
					<!-- Johannes: -->
					<!-- ~5 minutes -->
					<p>Protocol insights</p>
					<p>protobuf-based, expression trees in protocol</p>
				</section>
				<section>
					<!-- Rui: -->
					<!-- ~5 minutes -->
					<h2>Node.js</h2>
					<section id="nodejs-intro">
						<p>(straight) from the <a href="https://nodejs.org/en/">horse's mouth</a></p>
						<blockquote cite="https://nodejs.org/en/">
							Node.js® is a JavaScript runtime built on Chrome's V8 JavaScript engine.
							Node.js uses an event-driven, non-blocking I/O model that makes it lightweight and efficient.
							Node.js' package ecosystem, npm, is the largest ecosystem of open source libraries in the world.
						</blockquote>
					</section>
					<section id="nodejs-overview">
						<p>Overview</p>
						<ul>
							<li>async</li>
							<li>callbacks, promises, async/await</li>
							<li>single-threaded</li>
							<li>event loop</li>
							<li></li>
						</ul>
					</section>
				</section>
				<section>
					<!-- Rui: -->
					<!-- ~15 minutes -->
					<h2>MySQL Connector/Node.js</h2>
					<section id="cnodejs-overview">
						<p class="list-header">Overview</p>
						<ul>
							<li>Official implementation</li>
							<li>Based on the brand new X protocol</li>
							<li>Asynchronous and <span class="inline">Promise</span>-based</li>
							<li>Supports <span class="inline">async/await</span></li>
							<li>Fluent/chainable API (out-of-the-box query builder)</li>
							<li>Flexible parameter methods</li>
						</ul>
					</section>
					<section id="cnodejs-features">
						<p class="list-header">Some features</p>
						<ul>
							<li>Document store CRUD API</li>
							<li>Relational CRUD API</li>
							<li>Fallback to plain old SQL</li>
							<li>Transactions and row locking</li>
							<li>Secure sessions (SSL/TLS)</li>
							<li>Authentication</li>
							<li>Configuration handling interface</li>
						</ul>
					</section>
					<section id="cnodejs-features-fluent-api">
						<p>Fluent API (Document Store)</p>
						<pre>
							<code class="js" data-trim data-noescape>
								collection.add({ name: 'foo' }).add({ name: 'bar' }).execute()

								collection.find('$.name == :name').bind(name, 'foo').execute()

								collection.modify('$.name == "foo"').set('$.name', 'qux').execute()

								collection.remove('$.name == "bar"').execute()
							</code>
						</pre>
					</section>
					<section id="cnodejs-features-fluent-api-add-ebnf">
						<p><span class="inline">CollectionAdd</span></p>
						<img class="ebnf" src="images/collectionadd.png" alt="CollectionAdd EBNF">
					</section>
					<section id="cnodejs-features-fluent-api-find-ebnf">
						<p><span class="inline">CollectionFind</span></p>
						<img class="ebnf" src="images/collectionfind.png" alt="CollectionFind EBNF">
					</section>
					<section id="cnodejs-features-fluent-api-modify-ebnf">
						<p><span class="inline">CollectionModify</span></p>
						<img class="ebnf" src="images/collectionmodify.png" alt="CollectionModify EBNF">
					</section>
					<section id="cnodejs-features-fluent-api-remove-ebnf">
						<p><span class="inline">CollectionRemove</span></p>
						<img class="ebnf" src="images/collectionremove.png" alt="CollectionRemove EBNF">
					</section>
					<section id="cnodejs-features-sql-fallback">
						<p>Fallback to plain-old SQL</p>
						<pre>
							<code class="js" data-trim data-noescape>
							// insert document into a collection
							session.sql(`INSERT INTO collection (doc) values ('{"_id":"foo","name":"bar"}')`)
							  .execute()

							// project "name" property values
							session.sql(`SELECT JSON_EXTRACT(doc, '$.name') FROM collection`)
							  .execute()

							// create a virtual column and use it as an index
							session.sql(`ALTER TABLE collection ADD COLUMN name TEXT(3) GENERATED ALWAYS AS
							    (JSON_EXTRACT(doc, '$.name')) VIRTUAL, ADD INDEX i_name (name)`)
							  .execute()
							</code>
						</pre>
					</section>
					<section id="cnodejs-features-async">
						<p>Asynchronous API <=> <span class="inline">Promise</span></p>
						<ul>
							<li><span class="inline">getSession()</span></li>
							<li><span class="inline">createSchema()</span></li>
							<li><span class="inline">dropSchema()</span></li>
							<li><span class="inline">createCollection()</span></li>
							<li><span class="inline">dropCollection()</span></li>
							<li><span class="inline">execute()</span></li>
							<li>&hellip;</li>
						</ul>
					</section>
					<section id="cnodejs-features-cursors">
						<p>Simple push-based "cursors"</p>
						<pre>
							<code class="js" data-trim data-noescape>
							// the cursor gets executed for each element of the result set
							function cursor (p) {
							  // p: result set element currently being processed
							}

							collection.find().execute(cursor)
							</code>
						</pre>
					</section>
					<section id="cnodejs-features-completion">
						<p>Operation completion</p>
						<pre>
							<code class="js" data-trim data-noescape>
							collection
							  .find()
							  .execute()
							  .then(function (r) {
							    // r: instance of Result (coming up next)
							  })
							  .catch(function (e) {
							    // e: instance of Error
							  })
							</code>
						</pre>
					</section>
					<section id="cnodejs-features-results">
						<p><span class="inline">Result</span></p>
						<ul>
							<li><span class="inline">getDocumentId()</span></li>
							<li><span class="inline">getDocumentIds()</span></li>
							<li><span class="inline">getAffectedRowsCount()</span></li>
							<li><span class="inline">getWarnings()</span></li>
							<li><span class="inline">getWarningsCount()</span></li>
							<li>&hellip;</li>
						</ul>
					</section>
				</section>
				<section>
					<h2>Putting everything together</h2>
					<section id="cnodejs-snippet-boilerplate">
						<p>Boilerplate (sessions and schemas)</p>
						<pre>
							<code class="js" data-trim data-noescape>
								const mysqlx = require('@mysql/xdevapi')

								const session = await mysqlx.getSession('mysqlx://demo@localhost:33060')

								// re-create the schema
								await session.dropSchema('ple2017')
								const schema = await session.createSchema('ple2017')
							</code>
						</pre>
					</section>
					<section id="cnodejs-snippet-crud">
						<p>Working with collections and documents (<b class="orcl-red">CRUD</b>)</p>
						<pre>
							<code class="js" data-trim data-noescape>
								const schema = session.getSchema('ple2017')

								// re-create a collection
								await schema.dropCollection('demo')
								await schema.createCollection('demo')

								// or re-use an existing collection
								const collection = schema.createCollection('demo', { ReuseExistingObject: true })
							</code>
						</pre>
					</section>
					<section id="cnodejs-snippet-create">
						<p><b class="orcl-red">C</b>REATE</p>
						<pre>
							<code class="js" data-trim data-noescape>
							const collection = schema.getCollection('demo')

							// pipelining parallel calls
							await Promise.all([
							  collection.add({ name: 'foo' }).execute(),
							  collection.add([{ name: 'bar' }, { name: 'baz' }]).execute()
							])
							</code>
						</pre>
					</section>
					<section id="cnodejs-snippet-read">
						<p><b class="orcl-red">R</b>EAD</p>
						<pre>
							<code class="js" data-trim data-noescape>
								const collection = schema.getCollection('demo')
								const docs = []

								await collection
								  .find()
								  .execute(doc => doc && docs.push(doc))

								console.log(docs) // [{ name: 'foo' }, { name: 'bar' }, { name: 'baz' }]
							</code>
						</pre>
					</section>
					<section id="cnodejs-snippet-update">
						<P><b class="orcl-red">U</b>PDATE</P>
						<pre>
							<code class="js" data-trim data-noescape>
								const collection = schema.getCollection('demo')
								const docs = []

								await collection
								  .modify('$.name == "foo"')
								  .set('name', 'qux')
								  .set('oldName', 'foo')
								  .execute()

								await collection
								  .find()
								  .execute(doc => doc && docs.push(doc))

								console.log(docs) // [{ name: 'qux', oldName: 'foo' }, { name: 'bar' }, ... ]
							</code>
						</pre>
					</section>
					<section id="cnodejs-snippet-delete">
						<p><b class="orcl-red">D</b>ELETE</p>
						<pre>
							<code class="js" data-trim data-noescape>
								const collection = schema.getCollection('demo')
								const docs = []

								await collection
								  .remove('$.name == "qux"')
								  .execute()

								await collection
								  .find()
								  .execute(doc => doc && docs.push(doc))

								console.log(docs) // [{ name: 'bar' }, { name: 'baz' }]
							</code>
						</pre>
					</section>
					<section id="cnodejs-snippet-transactions">
						<p>Transaction Support</p>
						<pre>
							<code class="js" data-trim data-noescape>
							try {
							  await session.startTransaction()

							  const result = await schema.getCollection('child')
							    .add({ name: 'foo', parent: 'bar' })

							  await schema.getCollection('parent').modify('$._id == "bar"')
							    .arrayAppend('tracking', result.getDocumentId())

							  await session.commit()
							} catch (err) {
							  await session.rollback()
							}
							</code>
						</pre>
					</section>
				</section>
				<section>
					<!-- ~5 minutes -->
					<h2>DEMO</h2>
				</section>
				<section>
					<h2>Links</h2>
					<ul>
						<li><a href="https://dev.mysql.com/doc/refman/8.0/en/document-store.html">https://dev.mysql.com/doc/refman/8.0/en/document-store.html</a></li>
						<li><a href="https://dev.mysql.com/doc/x-devapi-userguide/en/">https://dev.mysql.com/doc/x-devapi-userguide/en/</a></li>
						<li><a href="https://www.npmjs.com/package/@mysql/xdevapi">https://www.npmjs.com/package/@mysql/xdevapi</a></li>
						<li><a href="https://github.com/mysql/mysql-connector-nodejs">https://github.com/mysql/mysql-connector-nodejs</a></li>
						<li><a href="https://dev.mysql.com/doc/dev/connector-nodejs/">https://dev.mysql.com/doc/dev/connector-nodejs/</a></li>
					</ul>
				</section>
				<section>
					<!-- ~5 minutes -->
					<p>Thank You &amp; Pointer to InnoDB Cluster &amp; DocStore Session by Jan</p>
				</section>
				<section>
					<img src="images/dolphin.jpg" style="border:0px;">
				</section>
				<section>
					<h2>Safe Harbor Statement</h2>
					<p>The preceding is intended to outline our general product direction. It is intended for information purposes only, and may not be incorporated into any contract. It is not a commitment to deliver any material, code, or functionality, and should not be relied upon in making purchasing decisions. The development, release, and timing of any features or functionality described for Oracle’s products remains at the sole discretion of Oracle.</p>
				</section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});

			Reveal.configure({
				slideNumber: true
			});
		</script>
	</body>
</html>
